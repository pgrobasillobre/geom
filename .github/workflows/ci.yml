# .github/workflows/ci.yml
# This workflow runs your Continuous Integration (CI):
# - On every Pull Request (PR)
# - On every push to the main branch (here: "master")
# It creates a clean machine, installs your package, and runs your test suite.

name: CI

on:
  # Run CI on every PR (so you see failures before merging)
  pull_request:

  # Also run CI when you push directly to the main branch
  push:
    branches: [ "master" ]

jobs:
  test:
    # GitHub provides a fresh Linux VM for the job
    runs-on: ubuntu-latest

    strategy:
      # If one Python version fails, still run the others (useful for debugging)
      fail-fast: false

      # Run the same job on multiple Python versions
      matrix:
        python-version: ["3.9", "3.10", "3.11", "3.12"]

    steps:
      # 1) Download (checkout) your repository into the runner
      - name: Checkout repository
        uses: actions/checkout@v5

      # 2) Install the chosen Python version for this matrix run
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

          # Cache pip downloads between runs to speed things up
          cache: "pip"

      # 3) Install your project like a user would.
      #    "-e ." installs in editable mode, useful in CI for source-based projects.
      - name: Install package
        run: |
          python -m pip install --upgrade pip
          python -m pip install -e .

      # If CI fails due to missing system libraries (e.g., gmsh),
      # you can add an Ubuntu dependency install step BEFORE "Install package".
      #
      # - name: Install system dependencies (if needed)
      #   run: |
      #     sudo apt-get update
      #     sudo apt-get install -y gmsh

      # 4) Run your test suite.
      #    Your repo already provides this script:
      #    ./geom/tests/run_all_tests.sh
      - name: Run tests
        run: |
          chmod +x ./geom/tests/run_all_tests.sh
          ./geom/tests/run_all_tests.sh

